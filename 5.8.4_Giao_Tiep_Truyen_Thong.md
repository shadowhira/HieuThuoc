# 5.8.4. Giao tiếp truyền thông (SREQ022, SREQ023, SREQ024, SREQ025)

Hệ thống quản lý hiệu thuốc đáp ứng các yêu cầu giao tiếp truyền thông sau:

## 1. Giao tiếp với dịch vụ Email (SREQ022)

- Hệ thống kết nối với dịch vụ SMTP của Gmail để gửi email thông báo, xác nhận đơn hàng và đặt lại mật khẩu.
- Giao thức sử dụng: SMTP với TLS/SSL.
- Cổng kết nối: 587.
- Yêu cầu xác thực: Tài khoản Gmail và mật khẩu ứng dụng.
- Định dạng nội dung: HTML.
- Thời gian phản hồi: Không quá 30 giây cho việc gửi email.
- Tần suất gửi: Tối đa 100 email/phút.

## 2. Giao tiếp với cổng thanh toán VNPay (SREQ023)

- Hệ thống tích hợp với cổng thanh toán VNPay để xử lý các giao dịch thanh toán trực tuyến.
- URL kết nối: https://sandbox.vnpayment.vn/paymentv2/vpcpay.html (môi trường sandbox).
- Giao thức sử dụng: HTTPS.
- Phương thức xác thực: HMAC SHA-512 với khóa bí mật.
- Định dạng dữ liệu: URL-encoded parameters.
- URL callback: http://localhost:4200/user/donmua?paymentStatus=success (môi trường phát triển).
- Thời gian phản hồi: Không quá 5 giây cho việc tạo URL thanh toán.
- Tần suất giao dịch: Không giới hạn.

## 3. Giao tiếp với dịch vụ lưu trữ đám mây Cloudinary (SREQ024)

- Hệ thống tích hợp với dịch vụ lưu trữ đám mây Cloudinary để lưu trữ hình ảnh sản phẩm, avatar người dùng.
- URL API: https://api.cloudinary.com/v1_1/{cloud_name}.
- Giao thức sử dụng: HTTPS.
- Phương thức xác thực: API Key và API Secret.
- Định dạng dữ liệu: Multipart/form-data cho upload, JSON cho response.
- Kích thước file tối đa: 10MB.
- Định dạng file hỗ trợ: JPEG, PNG, GIF.
- Thời gian phản hồi: Không quá 10 giây cho việc upload file.

## 4. Giao tiếp API RESTful giữa Frontend và Backend (SREQ025)

- Hệ thống sử dụng giao tiếp API RESTful giữa Frontend (Angular) và Backend (Spring Boot).
- URL cơ sở: http://localhost:8888/hieuthuoc (môi trường phát triển).
- Giao thức sử dụng: HTTP/HTTPS.
- Phương thức xác thực: JWT (JSON Web Token).
- Định dạng dữ liệu: JSON.
- Phương thức HTTP: GET, POST, PUT, DELETE.
- Thời gian phản hồi: Không quá 2 giây cho các API đơn giản, không quá 5 giây cho các API phức tạp.
- Tần suất gọi API: Tối đa 50 request/giây.
- Headers bắt buộc:
  - Authorization: Bearer {token} (cho các API yêu cầu xác thực)
  - Content-Type: application/json

## 5. Yêu cầu về môi trường triển khai

- Hệ thống vận hành trên máy chủ ứng dụng và được truy cập từ internet.
- Máy chủ ứng dụng phải có kết nối internet ổn định để giao tiếp với các dịch vụ bên ngoài (Email, VNPay, Cloudinary).
- Băng thông tối thiểu: 10 Mbps.
- Độ trễ tối đa: 100ms.
- Cổng mạng cần mở:
  - 80/443 (HTTP/HTTPS) cho giao tiếp với người dùng
  - 587 (SMTP) cho giao tiếp với dịch vụ email
  - 8888 (HTTP) cho giao tiếp nội bộ giữa Frontend và Backend

## 6. Yêu cầu về bảo mật truyền thông

- Tất cả giao tiếp với các dịch vụ bên ngoài phải sử dụng HTTPS/TLS.
- Thông tin xác thực (API keys, mật khẩu) không được lưu trữ trong mã nguồn, phải được lưu trữ trong biến môi trường hoặc file cấu hình riêng.
- Dữ liệu nhạy cảm (thông tin thanh toán, thông tin cá nhân) phải được mã hóa khi truyền tải.
- Các token xác thực phải có thời hạn hợp lý (5 phút cho JWT).
- Giới hạn tần suất gọi API (rate limiting) để phòng chống tấn công DDoS.

## 7. Yêu cầu về khả năng mở rộng

- Hệ thống phải có khả năng tích hợp thêm các dịch vụ thanh toán khác ngoài VNPay.
- Hệ thống phải có khả năng tích hợp với các dịch vụ gửi SMS để gửi thông báo đến người dùng.
- Hệ thống phải có khả năng tích hợp với các hệ thống quản lý kho bên ngoài.
- Các giao tiếp API phải được thiết kế theo chuẩn RESTful để dễ dàng mở rộng và tích hợp.
